<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NovaBlox API Explorer</title>
  <style>
    :root {
      --bg: #fbf7f0;
      --ink: #1c2732;
      --muted: #566574;
      --line: #d7cbb8;
      --card: #fffdf8;
      --accent: #005f86;
      --accent2: #0b8a66;
      --danger: #9f2b2b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Avenir Next", "Trebuchet MS", "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 12% 4%, rgba(11, 138, 102, 0.16), transparent 34%),
        radial-gradient(circle at 92% 12%, rgba(0, 95, 134, 0.2), transparent 30%),
        var(--bg);
      min-height: 100vh;
    }

    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px;
    }

    .hero {
      border-radius: 16px;
      background: linear-gradient(130deg, #014766, #006d85 52%, #0c8754);
      color: #f2fbff;
      padding: 20px;
      box-shadow: 0 14px 34px rgba(0, 39, 59, 0.2);
      margin-bottom: 14px;
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(1.4rem, 2.5vw, 2.1rem);
      letter-spacing: 0.01em;
    }

    .hero p {
      margin: 8px 0 0;
      color: #d5eef8;
      max-width: 72ch;
      font-size: 0.95rem;
    }

    .hero .callout {
      margin-top: 10px;
      border-left: 4px solid #f5c46d;
      background: rgba(255, 248, 230, 0.18);
      padding: 8px 10px;
      border-radius: 8px;
      color: #fff6df;
      font-size: 0.88rem;
    }

    .controls {
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr 220px 160px;
      margin-bottom: 12px;
    }

    input, select, button {
      font: inherit;
      border-radius: 10px;
      border: 1px solid #bfaf93;
      padding: 10px;
      background: #fff;
      color: var(--ink);
    }

    button {
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: var(--accent);
      color: #f1f9ff;
      transition: transform 120ms ease;
    }

    button:hover { transform: translateY(-1px); }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pill {
      border-radius: 999px;
      background: #edf3f4;
      color: #254252;
      padding: 5px 10px;
      font-size: 0.78rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .grid {
      display: grid;
      gap: 9px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 11px;
      box-shadow: 0 6px 16px rgba(26, 38, 51, 0.07);
      animation: rise 220ms ease;
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 5px;
      flex-wrap: wrap;
    }

    .method {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.72rem;
      font-weight: 800;
      letter-spacing: 0.06em;
      color: #fff;
      text-transform: uppercase;
      background: #35576c;
    }

    .method.get { background: #0a7a54; }
    .method.post { background: #045f8b; }

    .path {
      font-family: "Consolas", "Monaco", monospace;
      font-size: 0.82rem;
      color: #304a5d;
      word-break: break-word;
    }

    .desc {
      color: var(--muted);
      margin-top: 4px;
      font-size: 0.86rem;
      line-height: 1.35;
      min-height: 2.2em;
    }

    .meta-line {
      margin-top: 6px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 0.75rem;
      color: #3e5363;
    }

    .tag {
      border-radius: 999px;
      border: 1px solid #c5b9a5;
      padding: 2px 8px;
      background: #faf5ec;
    }

    .risk-safe { color: #1f7a4a; border-color: #95c8ae; background: #e9f6ee; }
    .risk-caution { color: #8a5a02; border-color: #dec07c; background: #fff3d8; }
    .risk-dangerous { color: var(--danger); border-color: #e2a3a3; background: #fdeaea; }

    .curl {
      margin-top: 7px;
      font-family: "Consolas", "Monaco", monospace;
      font-size: 0.74rem;
      color: #324a5a;
      background: #f5f7f8;
      border: 1px dashed #cfd6da;
      border-radius: 8px;
      padding: 7px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .copy {
      margin-top: 6px;
      background: #dfeaf0;
      color: #1e3545;
      border: 1px solid #b8ccd8;
      border-radius: 8px;
      padding: 6px 9px;
      font-weight: 700;
      font-size: 0.76rem;
      cursor: pointer;
    }

    .empty {
      text-align: center;
      color: #6f7e8a;
      padding: 18px;
      border: 1px dashed #c9baa0;
      border-radius: 12px;
      background: #fff;
    }

    @media (max-width: 980px) {
      .controls {
        grid-template-columns: 1fr;
      }
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="hero">
      <h1>NovaBlox API Explorer</h1>
      <p>Browsable endpoint index for buyers and developers. Filter by route, method, auth requirements, and risk profile.</p>
      <div class="callout">
        Import/capture note: Roblox Studio plugin APIs do not always allow fully programmatic local OBJ/FBX import or screenshots. NovaBlox preserves these routes with manual/external fallback guidance.
      </div>
    </section>

    <section class="controls">
      <input id="search" type="search" placeholder="Filter by route, action, category, or description" />
      <select id="method">
        <option value="all">All Methods</option>
        <option value="GET">GET</option>
        <option value="POST">POST</option>
      </select>
      <button id="refresh" type="button">Refresh</button>
    </section>

    <section class="meta" id="meta"></section>
    <section id="cards" class="grid"></section>
  </main>

  <script>
    const el = {
      search: document.getElementById("search"),
      method: document.getElementById("method"),
      refresh: document.getElementById("refresh"),
      meta: document.getElementById("meta"),
      cards: document.getElementById("cards"),
    };

    const state = {
      endpoints: [],
      capabilities: null,
    };

    function pill(text) {
      const span = document.createElement("span");
      span.className = "pill";
      span.textContent = text;
      return span;
    }

    function copyText(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).catch(() => {});
      }
    }

    function renderMeta() {
      el.meta.innerHTML = "";
      const caps = state.capabilities || {};
      const auth = caps.auth || {};
      const results = caps.results || {};
      const persistence = caps.persistence || {};

      el.meta.append(
        pill(`Endpoints: ${state.endpoints.length}`),
        pill(`Auth: ${auth.enabled ? "enabled" : "disabled"}`),
        pill(`Batch Results: ${results.batch ? "yes" : "no"}`),
        pill(`Queue Snapshot: ${persistence.queue_snapshot ? "on" : "off"}`)
      );
    }

    function endpointMatches(endpoint, search, method) {
      if (method !== "all" && endpoint.method !== method) {
        return false;
      }
      if (!search) {
        return true;
      }
      const blob = [
        endpoint.method,
        endpoint.path,
        endpoint.description,
        endpoint.category,
        endpoint.action,
        endpoint.auth,
        endpoint.risk,
      ].join(" ").toLowerCase();
      return blob.includes(search);
    }

    function renderEndpoints() {
      const search = el.search.value.trim().toLowerCase();
      const method = el.method.value;
      const filtered = state.endpoints.filter((ep) => endpointMatches(ep, search, method));

      el.cards.innerHTML = "";
      if (filtered.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "No endpoints match this filter.";
        el.cards.appendChild(empty);
        return;
      }

      filtered.forEach((endpoint) => {
        const card = document.createElement("article");
        card.className = "card";

        const curl = endpoint.example_curl || `${endpoint.method} ${endpoint.path}`;
        const riskClass = endpoint.risk ? `risk-${endpoint.risk}` : "";

        card.innerHTML = `
          <div class="head">
            <span class="method ${endpoint.method.toLowerCase()}">${endpoint.method}</span>
            <span class="tag ${riskClass}">${endpoint.risk || "safe"}</span>
          </div>
          <div class="path">${endpoint.path}</div>
          <div class="desc">${endpoint.description || "No description provided."}</div>
          <div class="meta-line">
            <span class="tag">auth: ${endpoint.auth || "public"}</span>
            <span class="tag">category: ${endpoint.category || "core"}</span>
            ${endpoint.action ? `<span class="tag">action: ${endpoint.action}</span>` : ""}
          </div>
          <div class="curl">${curl}</div>
        `;

        const copy = document.createElement("button");
        copy.type = "button";
        copy.className = "copy";
        copy.textContent = "Copy curl";
        copy.addEventListener("click", () => copyText(curl));
        card.appendChild(copy);

        el.cards.appendChild(card);
      });
    }

    async function load() {
      const [endpointsRes, capsRes] = await Promise.all([
        fetch("/bridge/docs/endpoints"),
        fetch("/bridge/capabilities"),
      ]);

      const endpoints = await endpointsRes.json().catch(() => ({ endpoints: [] }));
      const caps = await capsRes.json().catch(() => ({}));

      state.endpoints = Array.isArray(endpoints.endpoints) ? endpoints.endpoints : [];
      state.capabilities = caps.capabilities || null;

      renderMeta();
      renderEndpoints();
    }

    el.search.addEventListener("input", renderEndpoints);
    el.method.addEventListener("change", renderEndpoints);
    el.refresh.addEventListener("click", load);

    load();
  </script>
</body>
</html>
